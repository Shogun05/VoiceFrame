# Anime Instance Segmentation

Anime Instance Segmentation is a Python project for **segmenting characters from anime images or panels**. Users can select images (e.g., from `all_panels`) via a Gradio UI, and the project outputs **cropped/masked characters** in a timestamped folder.  

> ⚠️ Note: This project currently runs **CPU-only**.  

---

## Features

- Segment characters from anime images or panels.  
- Cropped/masked characters are saved in an organized timestamped folder.  
- Optional refinement using RefineNet (`refinenet_isnet`) for higher-quality masks.  
- Works with panels generated from other projects (`all_panels` folder).  
- Gradio UI for easy interaction.  

---

## Folder Structure

```
project-root/
│
├─ all_panels/               # Input panels generated by another project
├─ models/                   # Pretrained model files (downloaded via script)
│   └─ AnimeInstanceSegmentation/
│       ├─ rtmdetl_e60.ckpt
│       └─ ...
├─ output/                   # Segmentation outputs saved here
│   └─ processed_images_YYYYMMDD_HHMMSS/
│       ├─ 0_char_0.png
│       ├─ 1_char_1.png
│       └─ ...
├─ download_model.py         # Script to download the segmentation model
├─ app.py                    # Main Gradio UI app
├─ requirements.txt          # Dependencies
└─ utils/
    └─ constants.py          # Color palettes and constants
```

---

## Setup Instructions

### 1. Clone the Repository

```bash
git clone https://github.com/Shogun05/VoiceFrame.git
cd VoiceFrame
```

### 2. Install Dependencies

Ensure Python 3.8+ is installed, then run:

```bash
pip install -r requirements.txt
```

> ⚠️ If you encounter issues, make sure all packages are installed in the current environment.  

### 3. Download the Model

Run the provided script to download the segmentation model:

```bash
python download_model.py
```

This will create the folder:

```
models/AnimeInstanceSegmentation/
```

with the required checkpoint (`rtmdetl_e60.ckpt`).

---

## Running the App

Launch the Gradio UI:

```bash
python app.py
```

- Select images from `all_panels/` or your own images.  
- Click **Run** to segment characters.  
- Output cropped/masked characters will be saved in:

```
output/processed_images_YYYYMMDD_HHMMSS/
```

- Each file is named as `{index}_char_{i}.png` (e.g., `0_char_0.png`).  
- The original image is also displayed with colored bounding boxes.

---

## Optional: Refinement

By default, no refinement is applied (`refine_kwargs = None`).  

To enable **RefineNet** for better mask quality, modify `app.py`:

```python
refine_kwargs = {'refine_method': 'refinenet_isnet'}
```

---

## Notes

- **CPU-only Execution**: The project runs entirely on CPU by default.  
- **Input Panels**: Use images from the `all_panels/` folder or your own images.  
- **Dependencies**: Ensure all packages from `requirements.txt` are installed.  

---

## References

- Paper: [Instance-guided Cartoon Editing with a Large-scale Dataset](https://cartoonsegmentation.github.io/)  
- Hugging Face model: [dreMaz/AnimeInstanceSegmentation](https://huggingface.co/dreMaz/AnimeInstanceSegmentation)
